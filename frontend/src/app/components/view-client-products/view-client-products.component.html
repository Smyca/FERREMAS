<!-- Navbar -->
<app-navbar></app-navbar>

<div class="container">
  <!-- Header actualizado con margin-top para el navbar fijo -->
  <div class="header" style="margin-top: 90px;">
    <h1>ğŸ”§ FERREMAS</h1>
    <p>Sistema de GestiÃ³n de Productos de FerreterÃ­a y ConstrucciÃ³n</p>
  </div>

  <!-- Carrito Flotante -->
  <div class="cart-floating" (click)="toggleCart()">
    <div class="cart-icon">
      ğŸ›’
      <span class="cart-badge" *ngIf="getTotalItemsInCart() > 0">{{ getTotalItemsInCart() }}</span>
    </div>
  </div>

  <!-- Modal del Carrito -->
  <div class="cart-modal" [style.display]="cartModalVisible ? 'block' : 'none'">
    <div class="cart-modal-content">
      <div class="cart-header">
        <h3>ğŸ›’ Carrito de Compras</h3>
        <span class="close" (click)="toggleCart()">&times;</span>
      </div>
      <div class="cart-body">
        <ng-container *ngIf="cartItems.length === 0">
          <div class="empty-cart">
            <p>Tu carrito estÃ¡ vacÃ­o</p>
          </div>
        </ng-container>
        <ng-container *ngIf="cartItems.length > 0">
          <div *ngFor="let item of cartItems" class="cart-item">
            <div class="cart-item-info">
              <div class="cart-item-name">{{ item.nombre }}</div>
              <div class="cart-item-price">{{ formatNumber(item.precio) }} {{ monedaSeleccionada }}</div>
            </div>
            <div class="cart-item-controls">
              <button class="btn-small" (click)="decreaseQuantity(item)">-</button>
              <span class="quantity">{{ item.quantity }}</span>
              <button class="btn-small" (click)="increaseQuantity(item)">+</button>
              <button class="btn-small btn-remove" (click)="removeFromCart(item)">ğŸ—‘ï¸</button>
            </div>
          </div>
          <div class="cart-total">
            <strong>Total: {{ formatNumber(getCartTotal()) }} {{ monedaSeleccionada }}</strong>
          </div>
          <div class="cart-actions">
            <button class="btn btn-success" (click)="proceedToCheckout()">ğŸ’³ Proceder al Pago</button>
            <button class="btn btn-danger" (click)="clearCart()">ğŸ—‘ï¸ Vaciar Carrito</button>
          </div>
        </ng-container>
      </div>
    </div>
  </div>

  <!-- Controls -->
  <div class="controls">
    <div class="controls-header">
      <div class="currency-selector">
        <label for="moneda">ğŸ’° Mostrar precios en:</label>
        <select id="moneda" [(ngModel)]="monedaSeleccionada" (change)="cambiarMoneda()" class="currency-select">
          <option *ngFor="let m of monedasDisponibles" [value]="m">{{ m }}</option>
        </select>
      </div>
      <div class="actions-section">

      </div>
    </div>

    <div class="search-container">

      <input type="text" class="search-input" [(ngModel)]="searchTerm" (keyup)="searchProducts()"
        placeholder="Buscar productos por nombre, marca o categorÃ­a...">
      <select class="search-input" [(ngModel)]="selectedCategory" (change)="searchProducts()">
        <option value="">Todas las categorÃ­as</option>
        <option value="Herramientas ElÃ©ctricas">Herramientas ElÃ©ctricas</option>
        <option value="Herramientas Manuales">Herramientas Manuales</option>
        <option value="Materiales BÃ¡sicos">Materiales BÃ¡sicos</option>
        <option value="Acabados">Acabados</option>
        <option value="Equipos de Seguridad">Equipos de Seguridad</option>
        <option value="Tornillos y Anclajes">Tornillos y Anclajes</option>
      </select>
    </div>
  </div>

  <!-- Products Container -->
  <div class="products-container">
    <div class="products-header">
      <h3>Productos Disponibles</h3>
    </div>
    
    <div id="productsGrid" class="products-grid">
      <ng-container *ngIf="productosFiltrados.length === 0">
        <div style="text-align: center; padding: 40px; color: #7f8c8d;">
          No se encontraron productos
        </div>
      </ng-container>
      
      <ng-container *ngIf="productosFiltrados.length > 0">
        <div *ngFor="let product of productosFiltrados" class="product-card">
          <div class="product-header">
            <div class="product-code">{{ product.codigoProducto }}</div>
            <div [class]="'product-stock ' + getStockClass(product.stock)">
              {{ getStockText(product.stock) }}
            </div>
          </div>
          
          <!-- Imagen del producto -->
          <div class="product-image">
            <img 
              [src]="product.imagenUrl || 'assets/images/no-image.png'" 
              [alt]="product.nombre"
              (error)="onImageError($event)"
              loading="lazy">
          </div>
          
          <div class="product-name">{{ product.nombre }}</div>
          <div class="product-brand">ğŸ“¦ {{ product.marca }}</div>
          <div class="product-category">{{ product.categoria }}</div>
          <div class="product-description">{{ product.descripcion || 'Sin descripciÃ³n' }}</div>
          <div class="product-footer">
            <div class="product-price">
              {{ formatNumber(product.precio) }} {{ monedaSeleccionada }}
            </div>
            <div class="add-to-cart-section">
              <button 
                class="btn btn-primary add-to-cart-btn" 
                (click)="addToCart(product)"
                [disabled]="product.stock === 0">
                <span *ngIf="product.stock > 0">ğŸ›’ Agregar al Carrito</span>
                <span *ngIf="product.stock === 0">Sin Stock</span>
              </button>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </div>

